<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Macro Data Sequencer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #080c10;
    --bg2: #0d1117;
    --bg3: #141b24;
    --border: #1e2d3d;
    --text: #c9d1d9;
    --text-dim: #586069;
    --text-bright: #e6edf3;
    --accent: #58a6ff;
    --red-5: #ff2d55;
    --red-4: #e63950;
    --red-3: #c0392b;
    --red-2: #8b2635;
    --red-1: #4a1520;
    --grn-5: #00e676;
    --grn-4: #2ecc71;
    --grn-3: #27ae60;
    --grn-2: #1a6b3c;
    --grn-1: #0d3320;
    --neutral: #2a3340;
    --font-mono: 'IBM Plex Mono', monospace;
    --font-sans: 'IBM Plex Sans', sans-serif;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-sans);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Header */
  .header {
    background: var(--bg2);
    border-bottom: 1px solid var(--border);
    padding: 16px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-left { display: flex; align-items: center; gap: 16px; }

  .logo {
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 600;
    color: var(--accent);
    letter-spacing: 3px;
    text-transform: uppercase;
    border: 1px solid var(--accent);
    padding: 4px 10px;
  }

  .header-title {
    font-family: var(--font-mono);
    font-size: 13px;
    font-weight: 500;
    color: var(--text-bright);
    letter-spacing: 1px;
  }

  .header-subtitle {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-dim);
    letter-spacing: 1px;
    margin-top: 2px;
  }

  .live-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--grn-4);
    letter-spacing: 1px;
  }

  .live-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--grn-4);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  /* Controls */
  .controls {
    background: var(--bg2);
    border-bottom: 1px solid var(--border);
    padding: 12px 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
  }

  .control-label {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-dim);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-right: 4px;
  }

  .filter-group { display: flex; gap: 4px; align-items: center; }

  .filter-btn {
    font-family: var(--font-mono);
    font-size: 10px;
    padding: 4px 10px;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-dim);
    cursor: pointer;
    transition: all 0.15s;
    letter-spacing: 0.5px;
  }

  .filter-btn:hover { border-color: var(--accent); color: var(--accent); }
  .filter-btn.active { background: var(--accent); border-color: var(--accent); color: #000; font-weight: 600; }
  .filter-btn.active-red { background: var(--red-4); border-color: var(--red-4); color: #fff; }
  .filter-btn.active-grn { background: var(--grn-3); border-color: var(--grn-3); color: #fff; }

  .search-box {
    font-family: var(--font-mono);
    font-size: 11px;
    padding: 4px 12px;
    background: var(--bg3);
    border: 1px solid var(--border);
    color: var(--text);
    outline: none;
    width: 200px;
    transition: border-color 0.15s;
  }

  .search-box:focus { border-color: var(--accent); }
  .search-box::placeholder { color: var(--text-dim); }

  .sort-select {
    font-family: var(--font-mono);
    font-size: 10px;
    padding: 4px 10px;
    background: var(--bg3);
    border: 1px solid var(--border);
    color: var(--text);
    outline: none;
    cursor: pointer;
  }

  /* Stats bar */
  .stats-bar {
    display: flex;
    gap: 0;
    border-bottom: 1px solid var(--border);
    background: var(--bg3);
  }

  .stat-card {
    flex: 1;
    padding: 10px 20px;
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .stat-card:last-child { border-right: none; }

  .stat-label {
    font-family: var(--font-mono);
    font-size: 8px;
    color: var(--text-dim);
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .stat-value {
    font-family: var(--font-mono);
    font-size: 20px;
    font-weight: 600;
    color: var(--text-bright);
    line-height: 1;
  }

  .stat-value.red { color: var(--red-4); }
  .stat-value.green { color: var(--grn-4); }
  .stat-value.accent { color: var(--accent); }

  .stat-sub {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-dim);
  }

  /* Regime badge */
  .regime-badge {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 16px;
  }

  .regime-indicator {
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 600;
    padding: 4px 12px;
    letter-spacing: 1px;
  }

  .regime-q3 { background: rgba(255,45,85,0.15); color: var(--red-4); border: 1px solid var(--red-4); }
  .regime-desc { font-size: 10px; color: var(--text-dim); font-family: var(--font-mono); }

  /* Table */
  .table-container {
    overflow-x: auto;
    padding: 0 0 40px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-family: var(--font-mono);
    font-size: 10px;
  }

  thead tr {
    background: var(--bg3);
    position: sticky;
    top: 110px;
    z-index: 50;
  }

  .th-group {
    font-size: 8px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text-dim);
    padding: 6px 12px;
    text-align: center;
    border-bottom: 1px solid var(--border);
    border-right: 1px solid var(--border);
  }

  th {
    font-size: 8px;
    letter-spacing: 1px;
    color: var(--text-dim);
    padding: 6px 10px;
    text-align: center;
    border-bottom: 2px solid var(--border);
    border-right: 1px solid rgba(30,45,61,0.5);
    cursor: pointer;
    white-space: nowrap;
    font-weight: 500;
    text-transform: uppercase;
  }

  th:hover { color: var(--accent); }
  th.sort-active { color: var(--accent); }

  th.indicator-col {
    text-align: left;
    width: 260px;
    min-width: 260px;
  }

  td {
    padding: 0;
    border-bottom: 1px solid rgba(30,45,61,0.4);
    border-right: 1px solid rgba(30,45,61,0.3);
    vertical-align: middle;
  }

  tr.data-row:hover td { background: rgba(88,166,255,0.03); }
  tr.data-row { animation: fadeIn 0.3s ease both; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .indicator-cell {
    padding: 10px 16px;
    text-align: left;
    color: var(--text);
    font-size: 10px;
    font-weight: 400;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 260px;
    font-family: var(--font-sans);
    letter-spacing: 0.2px;
  }

  .indicator-region {
    font-size: 8px;
    color: var(--text-dim);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-top: 1px;
    font-family: var(--font-mono);
  }

  .signal-cell {
    text-align: center;
    min-width: 60px;
  }

  .signal-val {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 38px;
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 600;
    padding: 0 8px;
  }

  /* Score cell */
  .score-cell {
    text-align: center;
    min-width: 70px;
  }

  .score-bar-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 4px 8px;
    gap: 2px;
  }

  .score-num {
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 600;
  }

  .score-bar {
    width: 48px;
    height: 3px;
    background: var(--bg3);
    border-radius: 2px;
    overflow: hidden;
  }

  .score-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.5s ease;
  }

  .sparkline-cell {
    padding: 4px 8px;
    min-width: 80px;
  }

  .sparkline-canvas { display: block; }

  /* Color gradient helpers */
  .c-r5 { background-color: rgba(255,45,85,0.90); color: #fff; }
  .c-r4 { background-color: rgba(230,57,80,0.75); color: #fff; }
  .c-r3 { background-color: rgba(192,57,43,0.60); color: #ffb3b3; }
  .c-r2 { background-color: rgba(139,38,53,0.40); color: #ff9494; }
  .c-r1 { background-color: rgba(74,21,32,0.25); color: #ff7070; }
  .c-n  { background-color: rgba(42,51,64,0.30); color: var(--text-dim); }
  .c-g1 { background-color: rgba(13,51,32,0.25); color: #70ffaa; }
  .c-g2 { background-color: rgba(26,107,60,0.40); color: #5cffa0; }
  .c-g3 { background-color: rgba(39,174,96,0.55); color: #d4ffea; }
  .c-g4 { background-color: rgba(46,204,113,0.75); color: #fff; }
  .c-g5 { background-color: rgba(0,230,118,0.90); color: #000; }

  .section-divider {
    border-top: 2px solid var(--border) !important;
  }

  .region-header td {
    background: var(--bg3);
    padding: 4px 16px;
    font-family: var(--font-mono);
    font-size: 8px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--text-dim);
    border-bottom: 1px solid var(--border);
  }

  /* Tooltip */
  .tooltip {
    position: fixed;
    background: var(--bg3);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--font-mono);
    font-size: 10px;
    padding: 10px 14px;
    pointer-events: none;
    z-index: 1000;
    max-width: 240px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    display: none;
  }

  .tooltip-title {
    font-weight: 600;
    color: var(--text-bright);
    margin-bottom: 6px;
    font-size: 11px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 4px;
  }

  .tooltip-row {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    margin-top: 3px;
    font-size: 9px;
    color: var(--text-dim);
  }

  .tooltip-val { color: var(--text); font-weight: 500; }

  /* No results */
  .no-results {
    text-align: center;
    padding: 60px;
    font-family: var(--font-mono);
    color: var(--text-dim);
    font-size: 11px;
    letter-spacing: 1px;
  }

  .count-badge {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-dim);
    padding: 2px 8px;
    border: 1px solid var(--border);
    letter-spacing: 1px;
    margin-left: auto;
  }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <div class="logo">MDS</div>
    <div>
      <div class="header-title">MACRO DATA SEQUENCER</div>
      <div class="header-subtitle">HEDGEYE RISK MANAGEMENT · GLOBAL INDICATOR TRACKER</div>
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:24px;">
    <div>
      <div style="font-family:var(--font-mono);font-size:9px;color:var(--text-dim);letter-spacing:2px;">SNAPSHOT DATE</div>
      <div style="font-family:var(--font-mono);font-size:12px;color:var(--text-bright);">JAN–MAR 2021</div>
    </div>
    <div class="live-badge">
      <div class="live-dot"></div>
      LIVE
    </div>
  </div>
</div>

<div class="controls">
  <span class="control-label">REGION</span>
  <div class="filter-group" id="region-filters">
    <button class="filter-btn active" data-region="ALL" onclick="setFilter('region','ALL',this)">ALL</button>
    <button class="filter-btn" data-region="US" onclick="setFilter('region','US',this)">US</button>
    <button class="filter-btn" data-region="UK" onclick="setFilter('region','UK',this)">UK</button>
    <button class="filter-btn" data-region="EU" onclick="setFilter('region','EU',this)">EU</button>
    <button class="filter-btn" data-region="JAPAN" onclick="setFilter('region','JAPAN',this)">JAPAN</button>
    <button class="filter-btn" data-region="APAC" onclick="setFilter('region','APAC',this)">APAC</button>
    <button class="filter-btn" data-region="LATAM" onclick="setFilter('region','LATAM',this)">LATAM</button>
  </div>
  <div style="width:1px;height:20px;background:var(--border);margin:0 4px;"></div>
  <span class="control-label">SIGNAL</span>
  <div class="filter-group" id="signal-filters">
    <button class="filter-btn active" data-signal="ALL" onclick="setFilter('signal','ALL',this)">ALL</button>
    <button class="filter-btn" data-signal="BEARISH" onclick="setFilter('signal','BEARISH',this)" style="border-color:rgba(255,45,85,0.4);color:var(--red-4);">● BEARISH</button>
    <button class="filter-btn" data-signal="BULLISH" onclick="setFilter('signal','BULLISH',this)" style="border-color:rgba(46,204,113,0.4);color:var(--grn-4);">● BULLISH</button>
  </div>
  <div style="width:1px;height:20px;background:var(--border);margin:0 4px;"></div>
  <input class="search-box" type="text" placeholder="Search indicators..." oninput="doSearch(this.value)" id="search-input">
  <span class="count-badge" id="count-badge">30 indicators</span>
</div>

<!-- Stats Bar -->
<div class="stats-bar" id="stats-bar">
  <!-- populated by JS -->
</div>

<div class="table-container">
<table id="main-table">
<colgroup>
  <col style="width:260px">
  <col style="width:40px">
  <col style="width:65px">
  <col style="width:65px">
  <col style="width:65px">
  <col style="width:65px">
  <col style="width:65px">
  <col style="width:65px">
  <col style="width:85px">
</colgroup>
<thead>
<tr>
  <th class="indicator-col" onclick="sortBy('name')">INDICATOR ↕</th>
  <th onclick="sortBy('score')">SCORE</th>
  <th onclick="sortBy('roc')">RoC</th>
  <th onclick="sortBy('seq_prior')">PRIOR</th>
  <th onclick="sortBy('seq_latest')">LATEST</th>
  <th onclick="sortBy('hist_high')">HI SINCE</th>
  <th onclick="sortBy('hist_low')">LO SINCE</th>
  <th onclick="sortBy('trend_12')">12MMA</th>
  <th>TREND</th>
</tr>
</thead>
<tbody id="table-body">
</tbody>
</table>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
// ─── DATA ───────────────────────────────────────────────────────────────────
const indicators = [
  {
    name: "CBI MTE Full Volume of Total Order Book Balance",
    region: "UK", category: "Business Survey",
    roc: -13, seq_prior: -25, seq_latest: -38,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "4/30/2020",
    trend_12: -41.5, trend_6: -38.17, q_dec: -33, q_mar: -38,
    spark: [-20,-28,-35,-38,-36,-40,-38,-42,-38]
  },
  {
    name: "CBI MTE Full Avg Selling Prices Next 3M Balance",
    region: "UK", category: "Business Survey",
    roc: 4, seq_prior: 0, seq_latest: 4,
    hist_high: "3/31/2020", hist_low: "12/31/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: -3.17, trend_6: -1, q_dec: -1.33, q_mar: 4,
    spark: [-2,-1,0,1,0,2,3,2,4]
  },
  {
    name: "CBI ITS Q1 Quarterly Optimism Balance",
    region: "UK", category: "Business Survey",
    roc: 22, seq_prior: 0, seq_latest: -22,
    hist_high: "10/31/2020", hist_low: "4/30/2020",
    fast_since: "10/31/2020", slow_since: "4/30/2020",
    trend_12: -18.5, trend_6: -21.83, q_dec: null, q_mar: -22,
    spark: [-30,-22,-18,-20,-22,-24,-20,-22,-22]
  },
  {
    name: "Mexico Unemployment Rate (Workers 15+) ENOE NSA",
    region: "LATAM", category: "Labour",
    roc: -0.57, seq_prior: 4.37, seq_latest: 3.8,
    hist_high: "11/30/2020", hist_low: "3/31/2020",
    fast_since: "11/30/2020", slow_since: "3/31/2020",
    trend_12: 4.44, trend_6: 4.77, q_dec: 5.24, q_mar: 4.29,
    spark: [5.1,4.9,4.8,4.7,4.5,4.3,4.1,3.9,3.8]
  },
  {
    name: "Private Housing Authorized by Bldg Permits YoY %",
    region: "US", category: "Housing",
    roc: 9.02, seq_prior: 8.28, seq_latest: 17.3,
    hist_high: "10/31/2019", hist_low: "11/30/2020",
    fast_since: "7/31/2020", slow_since: "11/30/2020",
    trend_12: 3.64, trend_6: 7.45, q_dec: 5.47, q_mar: 9.43,
    spark: [2,4,6,8,10,12,14,16,17.3]
  },
  {
    name: "US New Privately Owned Housing Units Started YoY %",
    region: "US", category: "Housing",
    roc: -9.93, seq_prior: 15.1, seq_latest: 5.17,
    hist_high: "11/30/2020", hist_low: "8/31/2020",
    fast_since: "11/30/2020", slow_since: "8/31/2020",
    trend_12: 8.17, trend_6: 11.61, q_dec: 11.73, q_mar: 11.48,
    spark: [14,15,12,10,9,8,7,6,5.17]
  },
  {
    name: "Philadelphia Fed Business Outlook Survey DI",
    region: "US", category: "Business Survey",
    roc: 17.4, seq_prior: 9.1, seq_latest: 26.5,
    hist_high: "2/20/2020", hist_low: "12/31/2020",
    fast_since: "6/30/2020", slow_since: "12/31/2020",
    trend_12: 8.78, trend_6: 19.12, q_dec: 18.13, q_mar: 26.5,
    spark: [5,8,12,15,18,20,22,24,26.5]
  },
  {
    name: "Bloomberg US National Economy Expectations DI",
    region: "US", category: "Consumer",
    roc: 1.1, seq_prior: 38.5, seq_latest: 39,
    hist_high: "11/30/2020", hist_low: "12/31/2020",
    fast_since: "10/31/2020", slow_since: "12/31/2020",
    trend_12: 40.17, trend_6: 40.17, q_dec: 41.5, q_mar: 39,
    spark: [40,41,40,39,41,40,39,39,39]
  },
  {
    name: "European Commission Consumer Confidence Eurozone",
    region: "EU", category: "Consumer",
    roc: -1.7, seq_prior: -13.8, seq_latest: -15.5,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: -14.98, trend_6: -15.17, q_dec: -15.63, q_mar: -15.5,
    spark: [-13,-13.5,-14,-14.5,-15,-15.2,-15.4,-15.5,-15.5]
  },
  {
    name: "Markit Australia Manufacturing PMI SA",
    region: "APAC", category: "PMI",
    roc: 1.5, seq_prior: 55.7, seq_latest: 57.2,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: 52.09, trend_6: 55.32, q_dec: 55.23, q_mar: 57.8,
    spark: [50,52,53,54,55,55.5,56,56.5,57.2]
  },
  {
    name: "Markit Australia Services PMI SA",
    region: "APAC", category: "PMI",
    roc: -1.2, seq_prior: 57, seq_latest: 55.8,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "8/31/2020",
    trend_12: 47.22, trend_6: 53.57, q_dec: 55.27, q_mar: 55.8,
    spark: [52,54,55,56,57,56.5,56,55.9,55.8]
  },
  {
    name: "Japan CPI Nationwide YoY",
    region: "JAPAN", category: "Inflation",
    roc: -0.3, seq_prior: -0.9, seq_latest: -1.2,
    hist_high: "11/30/2020", hist_low: "1/31/2010",
    fast_since: "9/30/2020", slow_since: "11/30/2020",
    trend_12: -0.02, trend_6: -0.33, q_dec: 0.17, q_mar: -0.83,
    spark: [-0.4,-0.5,-0.6,-0.7,-0.8,-0.9,-1.0,-1.1,-1.2]
  },
  {
    name: "Japan CPI Nationwide Ex Fresh Food YoY",
    region: "JAPAN", category: "Inflation",
    roc: -0.1, seq_prior: -0.9, seq_latest: -1,
    hist_high: "11/30/2020", hist_low: "9/30/2010",
    fast_since: "9/30/2020", slow_since: "11/30/2020",
    trend_12: -0.16, trend_6: -0.55, q_dec: -0.23, q_mar: -0.87,
    spark: [-0.3,-0.4,-0.5,-0.6,-0.7,-0.8,-0.9,-0.95,-1]
  },
  {
    name: "GFK UK Consumer Confidence Indicator",
    region: "UK", category: "Consumer",
    roc: -2, seq_prior: -26, seq_latest: -28,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "10/31/2020",
    trend_12: -25.92, trend_6: -28.33, q_dec: -30, q_mar: -28,
    spark: [-24,-25,-26,-27,-27.5,-28,-28,-28,-28]
  },
  {
    name: "Jibun Bank Japan Manufacturing PMI SA",
    region: "JAPAN", category: "PMI",
    roc: -0.3, seq_prior: 50, seq_latest: 49.7,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "5/31/2020",
    trend_12: 45.88, trend_6: 48.72, q_dec: 49.23, q_mar: 49.7,
    spark: [47,48,49,50,49.5,49.2,49.5,49.6,49.7]
  },
  {
    name: "Jibun Bank Japan Service PMI Business Activity SA",
    region: "JAPAN", category: "PMI",
    roc: -2, seq_prior: 47.7, seq_latest: 45.7,
    hist_high: "8/31/2020", hist_low: "4/30/2020",
    fast_since: "12/31/2020", slow_since: "4/30/2020",
    trend_12: 41.65, trend_6: 45.8, q_dec: 47.73, q_mar: 45.7,
    spark: [48,47,46,46.5,47,47.5,47,46,45.7]
  },
  {
    name: "Australia Retail Sales YoY SA",
    region: "APAC", category: "Consumer",
    roc: null, seq_prior: null, seq_latest: null,
    hist_high: "12/31/2020", hist_low: "10/31/2020",
    fast_since: null, slow_since: null,
    trend_12: null, trend_6: null, q_dec: null, q_mar: null,
    spark: [3,4,3,5,4,3,4,3,4]
  },
  {
    name: "UK Retail Sales Ex Auto Fuel Chained Volume YoY SA",
    region: "UK", category: "Consumer",
    roc: 1.1, seq_prior: 5.3, seq_latest: 6.4,
    hist_high: "10/31/2020", hist_low: "11/30/2020",
    fast_since: "10/31/2020", slow_since: "11/30/2020",
    trend_12: 0.31, trend_6: 5.57, q_dec: 4.6, q_mar: 6.53,
    spark: [2,3,4,5,5.5,6,6.2,6.3,6.4]
  },
  {
    name: "Markit France Manufacturing PMI SA",
    region: "EU", category: "PMI",
    roc: 0.4, seq_prior: 51.1, seq_latest: 51.5,
    hist_high: "7/31/2020", hist_low: "12/31/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: 47.86, trend_6: 50.75, q_dec: 50.67, q_mar: 51.5,
    spark: [49,50,51,51.2,51,51.3,51.4,51.4,51.5]
  },
  {
    name: "Markit France Services PMI SA",
    region: "EU", category: "PMI",
    roc: -2.6, seq_prior: 49.1, seq_latest: 46.5,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: 42.43, trend_6: 46.65, q_dec: 44.8, q_mar: 46.5,
    spark: [49,48,48,47,47,46.8,46.6,46.5,46.5]
  },
  {
    name: "Markit/BME Germany Manufacturing PMI SA",
    region: "EU", category: "PMI",
    roc: -1.3, seq_prior: 58.3, seq_latest: 57,
    hist_high: "12/31/2020", hist_low: "9/30/2020",
    fast_since: "12/31/2020", slow_since: "4/30/2020",
    trend_12: 50.05, trend_6: 56.65, q_dec: 58.1, q_mar: 57,
    spark: [55,56,57,58,58.5,58.3,58,57.5,57]
  },
  {
    name: "Markit Germany Services PMI Business Activity SA",
    region: "EU", category: "PMI",
    roc: -0.2, seq_prior: 47, seq_latest: 46.8,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: 44.03, trend_6: 48.73, q_dec: 47.5, q_mar: 46.8,
    spark: [46,47,47.5,47,47,46.9,46.8,46.8,46.8]
  },
  {
    name: "Markit Eurozone Manufacturing PMI SA",
    region: "EU", category: "PMI",
    roc: -0.5, seq_prior: 55.2, seq_latest: 54.7,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: 49.13, trend_6: 53.98, q_dec: 54.6, q_mar: 54.7,
    spark: [52,53,54,55,55.2,55,54.8,54.7,54.7]
  },
  {
    name: "Markit Eurozone Services PMI SA",
    region: "EU", category: "PMI",
    roc: -1.4, seq_prior: 46.4, seq_latest: 45,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: 41.92, trend_6: 46.43, q_dec: 45, q_mar: 45,
    spark: [46,46.5,46.4,46.2,46,45.5,45.2,45,45]
  },
  {
    name: "Markit/CIPS UK Manufacturing PMI SA",
    region: "UK", category: "PMI",
    roc: -4.6, seq_prior: 57.5, seq_latest: 52.9,
    hist_high: "12/31/2020", hist_low: "6/30/2020",
    fast_since: "12/31/2020", slow_since: "4/30/2020",
    trend_12: 50.43, trend_6: 54.51, q_dec: 55.6, q_mar: 52.9,
    spark: [56,57,57.5,56,55,54,53.5,53,52.9]
  },
  {
    name: "Markit/CIPS UK Services PMI Business Activity SA",
    region: "UK", category: "PMI",
    roc: -10.6, seq_prior: 49.4, seq_latest: 38.8,
    hist_high: "12/31/2020", hist_low: "5/31/2020",
    fast_since: "12/31/2020", slow_since: "4/30/2020",
    trend_12: 44.65, trend_6: 50.55, q_dec: 49.47, q_mar: 38.8,
    spark: [49,49,49.4,48,45,43,41,40,38.8]
  },
  {
    name: "Markit US Manufacturing PMI SA",
    region: "US", category: "PMI",
    roc: 2.1, seq_prior: 57.1, seq_latest: 59.2,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: 54.3, trend_6: 57.8, q_dec: 57.5, q_mar: 59.2,
    spark: [55,56,57,57.5,58,58.5,59,59,59.2]
  },
  {
    name: "ISM US Manufacturing PMI",
    region: "US", category: "PMI",
    roc: 3.2, seq_prior: 60.5, seq_latest: 60.8,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: 55.4, trend_6: 59.2, q_dec: 60.1, q_mar: 60.8,
    spark: [57,58,59,60,60.5,60.3,60.5,60.6,60.8]
  },
  {
    name: "US Initial Jobless Claims (000s) SA",
    region: "US", category: "Labour",
    roc: -25, seq_prior: 848, seq_latest: 779,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "4/18/2020",
    trend_12: 693, trend_6: 812, q_dec: 830, q_mar: 779,
    spark: [900,880,860,840,820,810,800,790,779]
  },
  {
    name: "Conference Board US Consumer Confidence",
    region: "US", category: "Consumer",
    roc: 5.7, seq_prior: 87.1, seq_latest: 89.3,
    hist_high: "12/31/2020", hist_low: "11/30/2020",
    fast_since: "12/31/2020", slow_since: "11/30/2020",
    trend_12: 98.2, trend_6: 89.4, q_dec: 87.5, q_mar: 89.3,
    spark: [85,86,87,87.5,88,88.5,89,89.2,89.3]
  }
];

// ─── STATE ───────────────────────────────────────────────────────────────────
let filters = { region: 'ALL', signal: 'ALL', search: '' };
let sortKey = 'score';
let sortDir = 1;

// ─── SCORING ─────────────────────────────────────────────────────────────────
function computeScore(d) {
  // Score from -5 to +5 based on multiple signals
  let score = 0; let count = 0;
  if (d.roc !== null && d.roc !== undefined) {
    score += Math.sign(d.roc) * Math.min(Math.abs(d.roc) / 5, 1) * 2;
    count++;
  }
  if (d.seq_latest !== null && d.seq_latest !== undefined && d.seq_prior !== null) {
    score += Math.sign(d.seq_latest - d.seq_prior) * 1.5;
    count++;
  }
  if (d.trend_12 !== null && d.trend_12 !== undefined) {
    if (d.seq_latest !== null) {
      score += Math.sign(d.seq_latest - d.trend_12) * 1;
      count++;
    }
  }
  return count > 0 ? Math.max(-5, Math.min(5, score)) : 0;
}

// ─── COLOR HELPERS ───────────────────────────────────────────────────────────
function scoreClass(score) {
  if (score >= 3) return 'c-g5';
  if (score >= 1.5) return 'c-g3';
  if (score >= 0.5) return 'c-g2';
  if (score > -0.5) return 'c-n';
  if (score > -1.5) return 'c-r2';
  if (score > -3) return 'c-r3';
  return 'c-r5';
}

function rocClass(roc) {
  if (roc === null || roc === undefined) return 'c-n';
  if (roc >= 5) return 'c-g5';
  if (roc >= 2) return 'c-g3';
  if (roc >= 0.5) return 'c-g2';
  if (roc > -0.5) return 'c-n';
  if (roc > -2) return 'c-r2';
  if (roc > -5) return 'c-r3';
  return 'c-r5';
}

function deltaClass(latest, prior) {
  if (latest === null || prior === null) return 'c-n';
  const d = latest - prior;
  if (d >= 3) return 'c-g5';
  if (d >= 1) return 'c-g3';
  if (d >= 0.3) return 'c-g2';
  if (d > -0.3) return 'c-n';
  if (d > -1) return 'c-r2';
  if (d > -3) return 'c-r3';
  return 'c-r5';
}

function fmt(v) {
  if (v === null || v === undefined) return '—';
  return (v > 0 ? '+' : '') + Number(v).toFixed(2).replace(/\.00$/, '');
}

// ─── SPARKLINE ───────────────────────────────────────────────────────────────
function drawSparkline(canvas, data) {
  if (!canvas || !data || data.length < 2) return;
  const ctx = canvas.getContext('2d');
  const w = canvas.width, h = canvas.height;
  ctx.clearRect(0, 0, w, h);
  const min = Math.min(...data), max = Math.max(...data);
  const range = max - min || 1;
  const pts = data.map((v, i) => [
    (i / (data.length - 1)) * (w - 4) + 2,
    h - ((v - min) / range) * (h - 6) - 3
  ]);
  const last = data[data.length - 1];
  const first = data[0];
  const isUp = last >= first;
  const color = isUp ? '#2ecc71' : '#ff2d55';
  ctx.strokeStyle = color;
  ctx.lineWidth = 1.5;
  ctx.lineJoin = 'round';
  // fill
  ctx.beginPath();
  ctx.moveTo(pts[0][0], h);
  pts.forEach(p => ctx.lineTo(p[0], p[1]));
  ctx.lineTo(pts[pts.length-1][0], h);
  ctx.closePath();
  ctx.fillStyle = isUp ? 'rgba(46,204,113,0.1)' : 'rgba(255,45,85,0.1)';
  ctx.fill();
  // line
  ctx.beginPath();
  ctx.moveTo(pts[0][0], pts[0][1]);
  pts.slice(1).forEach(p => ctx.lineTo(p[0], p[1]));
  ctx.stroke();
  // dot
  const last_pt = pts[pts.length - 1];
  ctx.beginPath();
  ctx.arc(last_pt[0], last_pt[1], 2, 0, Math.PI * 2);
  ctx.fillStyle = color;
  ctx.fill();
}

// ─── RENDER ──────────────────────────────────────────────────────────────────
function getFilteredData() {
  return indicators.filter(d => {
    if (filters.region !== 'ALL' && d.region !== filters.region) return false;
    if (filters.signal !== 'ALL') {
      const s = computeScore(d);
      if (filters.signal === 'BEARISH' && s >= 0) return false;
      if (filters.signal === 'BULLISH' && s < 0) return false;
    }
    if (filters.search) {
      const q = filters.search.toLowerCase();
      if (!d.name.toLowerCase().includes(q) && !d.region.toLowerCase().includes(q) && !d.category.toLowerCase().includes(q)) return false;
    }
    return true;
  }).map(d => ({ ...d, score: computeScore(d) }))
    .sort((a, b) => {
      let av = a[sortKey], bv = b[sortKey];
      if (av === null || av === undefined) av = -Infinity;
      if (bv === null || bv === undefined) bv = -Infinity;
      return sortDir * (av < bv ? -1 : av > bv ? 1 : 0);
    });
}

function renderStats(data) {
  const bull = data.filter(d => d.score > 0).length;
  const bear = data.filter(d => d.score < 0).length;
  const neutral = data.filter(d => d.score === 0).length;
  const avgScore = data.reduce((s, d) => s + d.score, 0) / (data.length || 1);

  document.getElementById('stats-bar').innerHTML = `
    <div class="stat-card">
      <div class="stat-label">INDICATORS</div>
      <div class="stat-value accent">${data.length}</div>
      <div class="stat-sub">Currently showing</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">BULLISH</div>
      <div class="stat-value green">${bull}</div>
      <div class="stat-sub">${Math.round(bull/data.length*100)||0}% of total</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">BEARISH</div>
      <div class="stat-value red">${bear}</div>
      <div class="stat-sub">${Math.round(bear/data.length*100)||0}% of total</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">NET COMPOSITE</div>
      <div class="stat-value ${avgScore >= 0 ? 'green' : 'red'}">${avgScore.toFixed(2)}</div>
      <div class="stat-sub">Avg score (-5 to +5)</div>
    </div>
    <div class="stat-card" style="flex:2;background:var(--bg2);">
      <div class="stat-label">MACRO REGIME SIGNAL</div>
      <div style="display:flex;align-items:center;gap:12px;margin-top:4px;">
        <div class="regime-indicator ${avgScore < -0.5 ? 'regime-q3' : ''}" style="${avgScore >= 0.5 ? 'background:rgba(46,204,113,0.15);color:var(--grn-4);border:1px solid var(--grn-4);' : avgScore < -0.5 ? '' : 'background:rgba(88,166,255,0.1);color:var(--accent);border:1px solid var(--accent);'}">
          ${avgScore >= 0.5 ? 'QUAD 2 — RISK-ON' : avgScore < -0.5 ? 'QUAD 3 — RISK-OFF' : 'TRANSITIONAL'}
        </div>
        <div class="regime-desc">${avgScore >= 0.5 ? 'Growth accelerating · Inflation rising · Equities, Commodities favored' : avgScore < -0.5 ? 'Growth slowing · Deceleration dominating · Bonds, Gold, Defensives favored' : 'Mixed signals · Regime transition in progress · Selective positioning advised'}</div>
      </div>
    </div>
  `;
}

function renderTable() {
  const data = getFilteredData();
  document.getElementById('count-badge').textContent = `${data.length} indicator${data.length !== 1 ? 's' : ''}`;
  renderStats(data);

  const tbody = document.getElementById('table-body');
  if (data.length === 0) {
    tbody.innerHTML = `<tr><td colspan="9" class="no-results">NO INDICATORS MATCH · ADJUST FILTERS</td></tr>`;
    return;
  }

  let html = '';
  let delay = 0;
  data.forEach((d, i) => {
    const scoreVal = d.score;
    const scorePct = ((scoreVal + 5) / 10 * 100).toFixed(0);
    const scoreColor = scoreVal >= 0 ? 'var(--grn-4)' : 'var(--red-4)';
    const rocCls = rocClass(d.roc);
    const seqCls = deltaClass(d.seq_latest, d.seq_prior);
    const trendCls = rocClass(d.trend_12);

    html += `
    <tr class="data-row" style="animation-delay:${delay}ms" 
        onmouseenter="showTooltip(event, ${i})"
        onmouseleave="hideTooltip()">
      <td>
        <div class="indicator-cell" title="${d.name}">
          ${d.name}
          <div class="indicator-region">${d.region} · ${d.category}</div>
        </div>
      </td>
      <td class="score-cell">
        <div class="score-bar-container">
          <div class="score-num" style="color:${scoreColor}">${scoreVal.toFixed(1)}</div>
          <div class="score-bar">
            <div class="score-fill" style="width:${scorePct}%;background:${scoreColor};"></div>
          </div>
        </div>
      </td>
      <td class="signal-cell ${rocCls}"><div class="signal-val">${fmt(d.roc)}</div></td>
      <td class="signal-cell c-n"><div class="signal-val">${fmt(d.seq_prior)}</div></td>
      <td class="signal-cell ${seqCls}"><div class="signal-val">${fmt(d.seq_latest)}</div></td>
      <td class="signal-cell c-n" style="font-size:9px;"><div class="signal-val" style="font-size:9px;color:var(--text-dim)">${d.hist_high || '—'}</div></td>
      <td class="signal-cell c-n" style="font-size:9px;"><div class="signal-val" style="font-size:9px;color:var(--text-dim)">${d.hist_low || '—'}</div></td>
      <td class="signal-cell ${trendCls}"><div class="signal-val">${fmt(d.trend_12)}</div></td>
      <td class="sparkline-cell">
        <canvas class="sparkline-canvas" width="80" height="30" data-idx="${i}"></canvas>
      </td>
    </tr>`;
    delay += 15;
  });

  tbody.innerHTML = html;

  // Draw sparklines
  tbody.querySelectorAll('canvas[data-idx]').forEach(canvas => {
    const idx = parseInt(canvas.dataset.idx);
    drawSparkline(canvas, data[idx].spark);
  });

  // Store for tooltip
  window._tableData = data;
}

// ─── TOOLTIP ─────────────────────────────────────────────────────────────────
function showTooltip(e, i) {
  const d = window._tableData && window._tableData[i];
  if (!d) return;
  const tt = document.getElementById('tooltip');
  const scoreColor = d.score >= 0 ? 'var(--grn-4)' : 'var(--red-4)';
  tt.innerHTML = `
    <div class="tooltip-title">${d.name}</div>
    <div class="tooltip-row"><span>Region</span><span class="tooltip-val">${d.region}</span></div>
    <div class="tooltip-row"><span>Category</span><span class="tooltip-val">${d.category}</span></div>
    <div class="tooltip-row"><span>Composite Score</span><span class="tooltip-val" style="color:${scoreColor}">${d.score.toFixed(2)}</span></div>
    <div class="tooltip-row"><span>Rate of Change</span><span class="tooltip-val">${fmt(d.roc)}</span></div>
    <div class="tooltip-row"><span>Prior → Latest</span><span class="tooltip-val">${fmt(d.seq_prior)} → ${fmt(d.seq_latest)}</span></div>
    <div class="tooltip-row"><span>12MMA Trend</span><span class="tooltip-val">${fmt(d.trend_12)}</span></div>
    <div class="tooltip-row"><span>6MMA Trend</span><span class="tooltip-val">${fmt(d.trend_6)}</span></div>
    <div class="tooltip-row"><span>Q Dec → Q Mar</span><span class="tooltip-val">${fmt(d.q_dec)} → ${fmt(d.q_mar)}</span></div>
  `;
  tt.style.display = 'block';
  posTooltip(e);
}

function posTooltip(e) {
  const tt = document.getElementById('tooltip');
  let x = e.clientX + 16, y = e.clientY + 8;
  if (x + 250 > window.innerWidth) x = e.clientX - 260;
  if (y + 200 > window.innerHeight) y = e.clientY - 200;
  tt.style.left = x + 'px';
  tt.style.top = y + 'px';
}

document.addEventListener('mousemove', e => {
  const tt = document.getElementById('tooltip');
  if (tt.style.display === 'block') posTooltip(e);
});

function hideTooltip() {
  document.getElementById('tooltip').style.display = 'none';
}

// ─── CONTROLS ────────────────────────────────────────────────────────────────
function setFilter(type, val, btn) {
  filters[type] = val;
  const group = document.getElementById(type + '-filters');
  group.querySelectorAll('.filter-btn').forEach(b => {
    b.classList.remove('active', 'active-red', 'active-grn');
  });
  if (val === 'BEARISH') btn.classList.add('active-red');
  else if (val === 'BULLISH') btn.classList.add('active-grn');
  else btn.classList.add('active');
  renderTable();
}

function doSearch(val) {
  filters.search = val;
  renderTable();
}

function sortBy(key) {
  if (sortKey === key) sortDir *= -1;
  else { sortKey = key; sortDir = -1; }
  renderTable();
}

// ─── INIT ────────────────────────────────────────────────────────────────────
renderTable();
</script>
</body>
</html>
